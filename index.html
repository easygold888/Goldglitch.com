<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EasyGoldGlitch</title>
  <meta name="theme-color" content="#0b0b0f" />
  <style>
    :root{
      --bg:#07070a;
      --panel: rgba(20,20,26,.55);
      --panel2: rgba(20,20,26,.35);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.07);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --gold: #d6b35c;
      --gold2:#8f7a3b;
      --shadow: 0 20px 60px rgba(0,0,0,.55);
      --r: 22px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(214,179,92,.14), transparent 55%),
                  radial-gradient(900px 700px at 80% 25%, rgba(120,110,180,.10), transparent 55%),
                  var(--bg);
      overflow-x:hidden;
    }

    /* FX canvas */
    #fx{
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      z-index:0;
      pointer-events:none;
    }

    /* app shell */
    .wrap{
      position:relative;
      z-index:2;
      min-height:100%;
      padding: 18px 16px 80px;
    }

    .topbar{
      max-width:1100px;
      margin: 0 auto 18px;
      padding: 14px 14px;
      border:1px solid var(--stroke);
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 220px;
    }
    .brand img{
      width:34px;height:34px;border-radius:10px;
      border:1px solid var(--stroke2);
      background: rgba(255,255,255,.03);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      object-fit: cover;
    }
    .brand .name{ font-weight:800; letter-spacing:.4px; line-height:1; }
    .brand .tag{ color:var(--muted); font-size:12.5px; margin-top:4px; }

    .nav{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      flex: 1;
    }
    .pill{
      border:1px solid var(--stroke2);
      background: rgba(255,255,255,.04);
      padding: 9px 14px;
      border-radius: 999px;
      color: var(--text);
      font-size: 13px;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
    }
    .pill:hover{ transform: translateY(-1px); border-color: rgba(214,179,92,.35); }
    .pill.active{ border-color: rgba(214,179,92,.55); background: rgba(214,179,92,.10); }

    .right{
      display:flex; align-items:center; gap:10px; min-width: 150px; justify-content:flex-end;
    }
    .chip{
      border:1px solid var(--stroke2);
      background: rgba(255,255,255,.04);
      padding: 9px 12px;
      border-radius: 999px;
      color: var(--muted);
      font-size: 12.5px;
      white-space:nowrap;
    }
    .chip strong{ color: var(--text); font-weight:700; }

    .grid{
      max-width:1100px;
      margin: 0 auto;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
      .brand{ min-width: unset; }
      .right{ min-width: unset; }
    }

    .card{
      border:1px solid var(--stroke);
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      backdrop-filter: blur(16px);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .inner{ padding: 18px; }

    .kicker{
      display:inline-flex;
      gap:10px;
      align-items:center;
      font-size: 12.5px;
      color: var(--muted);
      border:1px solid var(--stroke2);
      border-radius: 999px;
      padding: 7px 10px;
      background: rgba(0,0,0,.18);
    }
    h1{
      margin: 14px 0 8px;
      font-size: clamp(34px, 4.6vw, 56px);
      letter-spacing: -0.8px;
      line-height: 1.02;
    }
    .sub{
      margin:0;
      color: var(--muted);
      font-size: 16px;
      line-height: 1.45;
    }

    .btns{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 16px; }
    .btn{
      padding: 11px 14px;
      border-radius: 14px;
      border:1px solid var(--stroke2);
      background: rgba(255,255,255,.04);
      color: var(--text);
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      font-weight:700;
      font-size: 13.5px;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(214,179,92,.35); }
    .btn.gold{
      border-color: rgba(214,179,92,.45);
      background: linear-gradient(180deg, rgba(214,179,92,.20), rgba(214,179,92,.08));
    }

    .sectionTitle{
      display:flex; align-items:baseline; justify-content:space-between; gap:10px;
      margin: 14px 0 10px;
      color: var(--muted);
      font-size: 13px;
    }

    .list{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }

    .item{
      padding: 14px;
      border-radius: 18px;
      border:1px solid var(--stroke2);
      background: rgba(0,0,0,.20);
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease;
    }
    .item:hover{ transform: translateY(-1px); border-color: rgba(214,179,92,.25); }

    .item h3{ margin:0; font-size: 16px; letter-spacing: -.2px; }
    .item p{ margin:6px 0 0; color: var(--muted); font-size: 13px; line-height:1.35; }

    .price{
      text-align:right;
      min-width: 110px;
    }
    .price .usd{
      font-weight:900;
      font-size: 18px;
      color: var(--gold);
    }
    .price .eth{
      margin-top:4px;
      font-size: 12.5px;
      color: var(--muted);
    }

    .side{
      display:grid;
      gap:14px;
    }

    .walletBox{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .qr{
      width: 86px; height: 86px;
      border-radius: 18px;
      border: 1px solid var(--stroke2);
      background: rgba(255,255,255,.03);
      overflow:hidden;
      flex:0 0 auto;
    }
    .qr img{ width:100%; height:100%; object-fit:cover; display:block; }
    .addr{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12.5px;
      color: var(--text);
      word-break: break-all;
      line-height:1.3;
    }
    .addr small{ display:block; color:var(--muted); margin-top:6px; font-family:inherit; }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      z-index: 50;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--stroke2);
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(14px);
      color: var(--text);
      font-size: 13px;
      opacity: 0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .toast.show{ opacity: 1; transform: translateX(-50%) translateY(-3px); }

    /* Mobile spacing so it doesn't feel "stacked" */
    @media (max-width: 520px){
      .topbar{ border-radius: 26px; padding: 12px; }
      .pill{ padding: 9px 12px; }
      .grid{ gap: 12px; }
      .card .inner{ padding: 16px; }
      .qr{ width:78px; height:78px; border-radius: 16px; }
    }
  </style>
</head>

<body>
  <canvas id="fx"></canvas>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <img src="/logo.png" alt="EasyGoldGlitch"
             onerror="this.style.display='none';" />
        <div>
          <div class="name">EasyGoldGlitch</div>
          <div class="tag">Stop trading. Start printing.</div>
        </div>
      </div>

      <nav class="nav" aria-label="Primary">
        <div class="pill active" data-view="home">Home</div>
        <div class="pill" data-view="glitches">Glitches</div>
        <div class="pill" data-view="philosophy">Philosophy</div>
        <div class="pill" data-view="terms">Terms</div>
      </nav>

      <div class="right">
        <div class="chip">ETH weekly high: <strong id="ethUsd">—</strong></div>
      </div>
    </div>

    <div class="grid">
      <!-- Main -->
      <div class="card">
        <div class="inner" id="view">
          <!-- content injected by JS -->
        </div>
      </div>

      <!-- Side -->
      <div class="side">
        <div class="card">
          <div class="inner">
            <div class="sectionTitle">
              <span>Wallet</span>
              <span style="color:rgba(214,179,92,.8)">ETH</span>
            </div>

            <div class="walletBox">
              <div class="qr">
                <img src="/assets/wallet.png" alt="Wallet QR"
                     onerror="this.style.opacity='.35';" />
              </div>
              <div>
                <div class="addr" id="walletAddr">Loading…</div>
                <small class="addr" style="color:var(--muted)" id="addrHint"></small>
                <div class="btns" style="margin-top:10px">
                  <button class="btn" id="copyAddrBtn" type="button">Copy</button>
                  <button class="btn gold" id="openCheckoutBtn" type="button">Checkout</button>
                </div>
              </div>
            </div>

          </div>
        </div>

        <div class="card">
          <div class="inner">
            <div class="sectionTitle">
              <span>Quick rules</span>
              <span>Low text • High signal</span>
            </div>
            <div style="color:var(--muted); font-size:13px; line-height:1.45">
              Pick a glitch. Pay in ETH. Paste TxHash. Get delivery.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ---------- Utils ----------
    const $ = (s, el=document) => el.querySelector(s);
    const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));
    const toast = (msg) => {
      const t = $("#toast");
      t.textContent = msg;
      t.classList.add("show");
      clearTimeout(toast._tm);
      toast._tm = setTimeout(()=>t.classList.remove("show"), 1400);
    };

    const USD = (n)=> new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n);

    // ---------- Data ----------
    const PRODUCTS = [
      { id:"g1", name:"Glitch 1.0 — Simple Sample", usd:50,  tags:["Demo • 2 months","1 trade at a time"], desc:"Low-noise execution." },
      { id:"g2", name:"Glitch 2.0 — Wealth Builder", usd:70, tags:["Demo • 2 months","Buy & hold+"], desc:"Steady compounding behavior." },
      { id:"pro", name:"Glitch PRO — F*ck Gold", usd:500, tags:["One-time","Lifetime"], desc:"Aggressive mode. For killers." },
      { id:"lg", name:"Little Glitcher", usd:150, tags:["Utility","Extends demo"], desc:"Demo extender. Multi-terminal helper." },
    ];

    let ETH_WEEKLY_HIGH = null; // usd per eth (weekly high)
    let currentView = "home";
    let selectedId = "g1";

    // ---------- Views ----------
    function renderHome(){
      const p = PRODUCTS.find(x=>x.id===selectedId) || PRODUCTS[0];
      $("#view").innerHTML = `
        <div class="kicker">Crypto-native • No sign-up</div>
        <h1>Stop trading.<br/>Start printing.</h1>
        <p class="sub">Choose a glitch. Pay in ETH. Get it delivered.</p>

        <div class="btns">
          <button class="btn gold" id="goGlitches">Browse glitches</button>
          <button class="btn" id="goCheckout">Checkout</button>
        </div>

        <div class="sectionTitle" style="margin-top:18px">
          <span>Fast picks</span>
          <span id="ethInfo">ETH price uses weekly high</span>
        </div>

        <div class="list" id="plist"></div>
      `;

      const list = $("#plist");
      for(const it of PRODUCTS){
        const eth = ETH_WEEKLY_HIGH ? (it.usd / ETH_WEEKLY_HIGH) : null;
        const ethTxt = eth ? `${eth.toFixed(4)} ETH` : "— ETH";
        const tags = it.tags.map(t=>`<span class="chip" style="padding:7px 10px">${t}</span>`).join(" ");
        const active = it.id===selectedId ? 'style="border-color: rgba(214,179,92,.35)"' : "";
        const html = `
          <div class="item" data-pick="${it.id}" ${active}>
            <div>
              <h3>${it.name}</h3>
              <p>${it.desc}</p>
              <div class="btns" style="margin-top:10px">${tags}</div>
            </div>
            <div class="price">
              <div class="usd">${USD(it.usd)}</div>
              <div class="eth">${ethTxt}</div>
            </div>
          </div>
        `;
        list.insertAdjacentHTML("beforeend", html);
      }

      $("#goGlitches").onclick = ()=> setView("glitches");
      $("#goCheckout").onclick = ()=> openCheckout();
      $$("#plist .item").forEach(el=>{
        el.onclick = ()=> { selectedId = el.dataset.pick; renderHome(); };
      });
    }

    function renderGlitches(){
      const p = PRODUCTS.find(x=>x.id===selectedId) || PRODUCTS[0];
      const eth = ETH_WEEKLY_HIGH ? (p.usd / ETH_WEEKLY_HIGH) : null;

      $("#view").innerHTML = `
        <div class="kicker">Pick your glitch</div>
        <h1>${p.name}</h1>
        <p class="sub">${p.desc}</p>

        <div class="btns" style="margin-top:14px">
          ${PRODUCTS.map(x=>`
            <button class="btn ${x.id===selectedId?'gold':''}" data-sel="${x.id}">
              ${x.id===selectedId ? "Selected" : "Select"}
            </button>
          `).join("")}
        </div>

        <div class="sectionTitle" style="margin-top:18px">
          <span>Price</span>
          <span>${USD(p.usd)} • <strong style="color:var(--gold)">${eth ? eth.toFixed(4)+" ETH" : "— ETH"}</strong></span>
        </div>

        <div class="btns" style="margin-top:12px">
          <button class="btn gold" id="glCheckout">Checkout</button>
          <button class="btn" id="glBack">Back</button>
        </div>
      `;

      $$("[data-sel]").forEach(b=>{
        b.onclick = ()=> { selectedId = b.dataset.sel; renderGlitches(); };
      });
      $("#glCheckout").onclick = ()=> openCheckout();
      $("#glBack").onclick = ()=> setView("home");
    }

    function renderPhilosophy(){
      $("#view").innerHTML = `
        <div class="kicker">Philosophy</div>
        <h1>The market is automated.</h1>
        <p class="sub">
          The creator watched the tape and realized the truth: most flow is machine-driven.
          Manual traders get farmed by execution, latency, and psychology.
          So we built glitches — small, repeatable edges that don’t care about feelings.
        </p>
      `;
    }

    function renderTerms(){
      $("#view").innerHTML = `
        <div class="kicker">Terms</div>
        <h1>Disclaimers.</h1>
        <p class="sub">
          Trading is high-risk. You can lose part or all of your capital. Past performance does not guarantee future results.
          Digital goods are final sale. No refunds.
          Demo licenses last <strong>2 months</strong>. Little Glitcher is a utility product that may extend demo usability.
          PRO is one-time payment, lifetime license.
        </p>
      `;
    }

    function setView(v){
      currentView = v;
      $$(".pill").forEach(p=>p.classList.toggle("active", p.dataset.view===v));
      if(v==="home") renderHome();
      else if(v==="glitches") renderGlitches();
      else if(v==="philosophy") renderPhilosophy();
      else renderTerms();
    }

    // ---------- Checkout (MVP UI stub) ----------
    function openCheckout(){
      const p = PRODUCTS.find(x=>x.id===selectedId) || PRODUCTS[0];
      const eth = ETH_WEEKLY_HIGH ? (p.usd / ETH_WEEKLY_HIGH) : null;

      // Minimal “modal” prompt for now (fast). Later we make a real modal.
      const ok = confirm(
        `Checkout:\n\n${p.name}\n${USD(p.usd)} (${eth ? eth.toFixed(4) : "—"} ETH)\n\nProceed?`
      );
      if(ok) toast("Next: TxHash screen (backend step)");
    }

    // ---------- Load wallet address safely ----------
    async function loadWalletAddress(){
      const el = $("#walletAddr");
      const hint = $("#addrHint");

      try{
        const res = await fetch("/assets/address.txt", { cache: "no-store" });
        const text = await res.text();

        // Protect UI from HTML injection / wrong URL (GitHub blob / fallback HTML)
        if (text.includes("<!DOCTYPE") || text.includes("<html")) throw new Error("address.txt returned HTML (wrong path or wrong source)");

        const m = text.match(/0x[a-fA-F0-9]{40}/);
        if(!m) throw new Error("No 0x address found in address.txt");

        const addr = m[0];
        el.textContent = addr;
        hint.textContent = "Send ETH here (then paste TxHash).";
      }catch(e){
        el.textContent = "Wallet address unavailable";
        hint.textContent = "Fix: /address.txt must contain ONLY the 0x address.";
        console.warn(e);
      }
    }

    // ---------- ETH quote ----------
    async function loadEthQuote(){
      try{
        const res = await fetch("/api/eth-quote", { cache:"no-store" });
        const data = await res.json();
        if(!data?.ok) throw new Error(data?.error || "quote error");
        ETH_WEEKLY_HIGH = Number(data.ethUsdWeeklyHigh) || null;
        $("#ethUsd").textContent = ETH_WEEKLY_HIGH ? USD(ETH_WEEKLY_HIGH) : "—";
      }catch(e){
        $("#ethUsd").textContent = "—";
        console.warn("ETH quote failed:", e);
      }
    }

    // ---------- Copy ----------
    $("#copyAddrBtn").onclick = async () => {
      const addr = $("#walletAddr").textContent.trim();
      if(!addr.startsWith("0x")) return toast("No address to copy");
      await navigator.clipboard.writeText(addr);
      toast("Copied");
    };

    $("#openCheckoutBtn").onclick = ()=> openCheckout();

    $$(".pill").forEach(p => p.onclick = ()=> setView(p.dataset.view));

    // ---------- FX (interactive particles) ----------
    (function(){
      const canvas = document.getElementById("fx");
      const ctx = canvas.getContext("2d", { alpha:true });

      let W=0,H=0, DPR=1;
      const isMobile = matchMedia("(max-width: 700px)").matches;
      const PCOUNT = isMobile ? 70 : 130;
      const CLUSTERS = isMobile ? 3 : 5;

      const pointer = { x:0,y:0, down:false, t:0 };

      const clusters = Array.from({length:CLUSTERS}, ()=>({
        x: Math.random(), y: Math.random(),
        vx:(Math.random()*2-1)*0.00025, vy:(Math.random()*2-1)*0.00025,
      }));

      const parts = Array.from({length:PCOUNT}, (_,i)=>makeParticle(i));
      function makeParticle(i){
        return {
          x: Math.random(),
          y: Math.random(),
          vx:(Math.random()*2-1)*0.0015,
          vy:(Math.random()*2-1)*0.0015,
          r: 0.7 + Math.random()*1.7,
          a: 0.20 + Math.random()*0.55,
          c: i % CLUSTERS
        };
      }

      function resize(){
        DPR = Math.min(2, window.devicePixelRatio || 1);
        W = Math.floor(innerWidth);
        H = Math.floor(innerHeight);
        canvas.width = Math.floor(W * DPR);
        canvas.height = Math.floor(H * DPR);
        canvas.style.width = W+"px";
        canvas.style.height = H+"px";
        ctx.setTransform(DPR,0,0,DPR,0,0);
      }
      addEventListener("resize", resize, { passive:true });
      resize();

      function spawnBurst(px,py){
        const cx = px / W, cy = py / H;
        for(let i=0;i<18;i++){
          const p = makeParticle(i);
          p.x = cx; p.y = cy;
          const ang = Math.random()*Math.PI*2;
          const sp = 0.006 + Math.random()*0.010;
          p.vx = Math.cos(ang)*sp;
          p.vy = Math.sin(ang)*sp;
          p.a = 0.40 + Math.random()*0.40;
          p.r = 0.9 + Math.random()*2.2;
          parts.push(p);
        }
        // cap
        while(parts.length > (PCOUNT + 40)) parts.shift();
      }

      function onPointer(e){
        const t = e.touches?.[0] || e;
        pointer.x = t.clientX;
        pointer.y = t.clientY;
      }
      addEventListener("pointermove", onPointer, { passive:true });
      addEventListener("touchmove", onPointer, { passive:true });

      addEventListener("pointerdown", (e)=>{
        pointer.down = true; pointer.t = performance.now();
        onPointer(e);
        spawnBurst(pointer.x, pointer.y);
        // make canvas feel “alive” on taps
        canvas.style.filter = "drop-shadow(0 0 14px rgba(214,179,92,.08))";
        setTimeout(()=>canvas.style.filter="none", 180);
      }, { passive:true });

      addEventListener("pointerup", ()=> pointer.down=false, { passive:true });

      function step(){
        // clear w/ slight trail
        ctx.clearRect(0,0,W,H);

        // drift clusters
        for(const c of clusters){
          c.x += c.vx; c.y += c.vy;
          if(c.x<0.05||c.x>0.95) c.vx*=-1;
          if(c.y<0.05||c.y>0.95) c.vy*=-1;
        }

        // update particles
        for(const p of parts){
          const c = clusters[p.c];
          const tx = c.x - p.x;
          const ty = c.y - p.y;

          // attraction to cluster
          p.vx += tx * 0.0009;
          p.vy += ty * 0.0009;

          // gentle noise
          p.vx += (Math.random()*2-1)*0.00035;
          p.vy += (Math.random()*2-1)*0.00035;

          // pointer interaction (tap “pull”)
          const px = pointer.x / W, py = pointer.y / H;
          const dx = px - p.x, dy = py - p.y;
          const d2 = dx*dx + dy*dy;
          if(d2 < 0.020){
            const k = pointer.down ? 0.0032 : 0.0012;
            p.vx += dx * k;
            p.vy += dy * k;
          }

          // damping
          p.vx *= 0.965;
          p.vy *= 0.965;

          p.x += p.vx;
          p.y += p.vy;

          // wrap
          if(p.x<0) p.x+=1;
          if(p.x>1) p.x-=1;
          if(p.y<0) p.y+=1;
          if(p.y>1) p.y-=1;
        }

        // draw
        for(let i=0;i<parts.length;i++){
          const a = parts[i];
          const ax = a.x*W, ay=a.y*H;

          // lines (clustered feel)
          for(let j=i+1;j<parts.length;j++){
            const b=parts[j];
            const bx=b.x*W, by=b.y*H;
            const dx=ax-bx, dy=ay-by;
            const d = Math.hypot(dx,dy);
            if(d < (isMobile ? 70 : 92)){
              const alpha = (1 - d/(isMobile ? 70 : 92)) * 0.10;
              ctx.strokeStyle = `rgba(214,179,92,${alpha})`;
              ctx.lineWidth = 1;
              ctx.beginPath();
              ctx.moveTo(ax,ay);
              ctx.lineTo(bx,by);
              ctx.stroke();
            }
          }

          // particle glow
          const g = ctx.createRadialGradient(ax,ay,0, ax,ay, a.r*10);
          g.addColorStop(0, `rgba(214,179,92,${a.a})`);
          g.addColorStop(1, `rgba(214,179,92,0)`);
          ctx.fillStyle = g;
          ctx.beginPath();
          ctx.arc(ax,ay, a.r*6, 0, Math.PI*2);
          ctx.fill();
        }

        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    })();

    // ---------- Init ----------
    (async function init(){
      await loadEthQuote();
      await loadWalletAddress();
      setView("home");
    })();
  </script>
</body>
</html>
