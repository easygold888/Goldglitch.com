<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>EasyGoldGlitch</title>
  <meta name="theme-color" content="#0a0a0c" />
  <style>
    :root{
      --bg0:#07070a;
      --bg1:#0b0c10;
      --glass: rgba(255,255,255,.06);
      --glass2: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --muted2: rgba(255,255,255,.45);
      --gold: #d7b56a;
      --gold2:#a88a45;
      --shadow: 0 18px 70px rgba(0,0,0,.55);
      --r: 22px;
      --r2: 28px;
      --max: 1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 25% 10%, rgba(215,181,106,.10), transparent 55%),
                  radial-gradient(900px 600px at 70% 25%, rgba(110,130,255,.09), transparent 60%),
                  radial-gradient(900px 900px at 50% 90%, rgba(255,255,255,.05), transparent 55%),
                  linear-gradient(180deg,var(--bg0),var(--bg1));
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      overflow-x:hidden;
    }

    /* particle canvas */
    #fx{
      position: fixed;
      inset: 0;
      z-index: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .noise{
      position:fixed; inset:0; z-index:1; pointer-events:none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='.10'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
      opacity:.22;
    }

    .wrap{ position:relative; z-index:2; }

    .top{
      position: sticky; top:0; z-index:10;
      padding: 14px 14px 10px;
      backdrop-filter: blur(18px) saturate(1.25);
    }
    .topbar{
      max-width: var(--max);
      margin:0 auto;
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      padding: 10px 12px;
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      min-width: 0;
    }
    .brand img{
      width:34px; height:34px; border-radius: 12px;
      border:1px solid rgba(215,181,106,.25);
      box-shadow: 0 10px 30px rgba(215,181,106,.10);
      background: rgba(0,0,0,.25);
      object-fit: cover;
    }
    .brand .t{
      display:flex; flex-direction:column; line-height:1.1;
      min-width:0;
    }
    .brand .t b{ letter-spacing:.5px; font-size:16px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .brand .t span{ color:var(--muted); font-size:12.5px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .nav{
      display:flex; gap:8px; align-items:center;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 10px 14px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.82);
      text-decoration:none;
      font-size: 13px;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .pill:hover{ transform: translateY(-1px); border-color: rgba(215,181,106,.25); }
    .pill:active{ transform: translateY(0px) scale(.98); }

    .actions{ display:flex; gap:8px; align-items:center; }
    .iconbtn{
      width:42px; height:42px; border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      display:grid; place-items:center;
      cursor:pointer;
      transition: transform .15s ease, border-color .15s ease;
      -webkit-tap-highlight-color: transparent;
      position: relative;
    }
    .iconbtn:hover{ transform: translateY(-1px); border-color: rgba(215,181,106,.22); }
    .iconbtn:active{ transform: translateY(0px) scale(.98); }
    .badge{
      position:absolute; top:-6px; right:-6px;
      min-width: 20px; height:20px; padding:0 6px;
      border-radius: 999px;
      background: rgba(215,181,106,.18);
      border:1px solid rgba(215,181,106,.35);
      color: var(--text);
      font-size: 12px;
      display:grid; place-items:center;
    }

    main{ max-width: var(--max); margin: 0 auto; padding: 12px 14px 90px; }

    .hero{
      margin-top: 10px;
      border-radius: var(--r2);
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      box-shadow: var(--shadow);
      padding: 26px 22px;
      position: relative;
      overflow:hidden;
    }
    .hero:before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(800px 300px at 20% 15%, rgba(215,181,106,.15), transparent 55%),
                  radial-gradient(600px 300px at 80% 25%, rgba(140,165,255,.12), transparent 60%);
      opacity:.65;
      pointer-events:none;
    }
    .hero > *{ position:relative; z-index:1; }
    .kicker{
      display:inline-flex; align-items:center; gap:10px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.78);
      font-size: 13px;
      margin-bottom: 14px;
    }
    h1{
      margin:0;
      font-size: clamp(34px, 6vw, 64px);
      letter-spacing: -1px;
      line-height: .96;
    }
    .sub{
      margin: 12px 0 18px;
      color: var(--muted);
      font-size: 16px;
      max-width: 58ch;
    }
    .cta{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center;
    }
    .btn{
      padding: 12px 16px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-weight: 600;
      cursor:pointer;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      -webkit-tap-highlight-color: transparent;
      display:inline-flex; gap:10px; align-items:center;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(215,181,106,.22); }
    .btn:active{ transform: translateY(0px) scale(.98); }
    .btn.primary{
      background: linear-gradient(180deg, rgba(215,181,106,.20), rgba(215,181,106,.10));
      border-color: rgba(215,181,106,.35);
    }

    .row{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 14px;
      margin-top: 14px;
    }
    .card{
      border-radius: var(--r);
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      box-shadow: 0 16px 55px rgba(0,0,0,.45);
      padding: 16px;
      overflow:hidden;
    }
    .card h3{ margin:0 0 8px; font-size: 16px; letter-spacing:.2px; }
    .muted{ color: var(--muted); font-size: 13.5px; }
    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
      margin-top: 12px;
    }
    .g{
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      padding: 14px;
      position:relative;
      cursor:pointer;
      transition: transform .15s ease, border-color .15s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .g:hover{ transform: translateY(-1px); border-color: rgba(215,181,106,.22); }
    .g:active{ transform: translateY(0px) scale(.99); }
    .g .topline{
      display:flex; justify-content:space-between; gap:10px; align-items:flex-start;
      margin-bottom: 8px;
    }
    .g b{ font-size: 14.5px; letter-spacing:.2px; }
    .price{
      color: rgba(215,181,106,.92);
      font-weight: 800;
      font-size: 14.5px;
      white-space:nowrap;
    }
    .tags{ display:flex; gap:8px; flex-wrap:wrap; margin-top: 10px; }
    .tag{
      padding: 7px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      color: rgba(255,255,255,.75);
      font-size: 12px;
    }
    .ethline{
      margin-top: 10px;
      color: rgba(255,255,255,.70);
      font-size: 12.5px;
    }

    /* Drawer / modal */
    .shade{
      position:fixed; inset:0; z-index:30;
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      display:none;
    }
    .sheet{
      position:fixed;
      left:50%;
      transform: translateX(-50%);
      bottom: 14px;
      width:min(var(--max), calc(100vw - 28px));
      border-radius: 26px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(20,20,24,.72);
      backdrop-filter: blur(18px) saturate(1.25);
      box-shadow: var(--shadow);
      z-index:31;
      display:none;
      overflow:hidden;
    }
    .sheet .hd{
      padding: 14px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .sheet .bd{ padding: 14px 16px 16px; }
    .close{
      width:38px; height:38px; border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      cursor:pointer;
    }

    .checkoutGrid{
      display:grid;
      grid-template-columns: 1fr 1.1fr;
      gap: 12px;
      align-items:start;
    }
    .walletBox{
      display:flex; gap:12px; align-items:center;
      padding: 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
    }
    .walletBox img{ width:88px; height:88px; border-radius: 16px; border:1px solid rgba(255,255,255,.10); background:#0b0b0f; object-fit:cover; }
    .addr{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px; color: rgba(255,255,255,.80);
      word-break: break-all;
      margin-top: 6px;
    }
    .field{
      display:flex; flex-direction:column; gap:8px;
      margin-top: 10px;
    }
    input{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      color: var(--text);
      outline:none;
    }
    input:focus{ border-color: rgba(215,181,106,.28); }
    .checkrow{
      display:flex; gap:10px; align-items:flex-start;
      margin-top: 12px;
      color: rgba(255,255,255,.72);
      font-size: 12.5px;
    }
    .checkrow input{ width:auto; margin-top: 2px; }

    .toast{
      position:fixed; left:50%; transform: translateX(-50%);
      bottom: 18px; z-index:40;
      padding: 10px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(15,15,18,.75);
      backdrop-filter: blur(14px);
      color: rgba(255,255,255,.86);
      display:none;
      box-shadow: 0 18px 70px rgba(0,0,0,.55);
      font-size: 13px;
    }

    /* mobile */
    @media (max-width: 860px){
      .nav{ display:none; }
      .row{ grid-template-columns: 1fr; }
      .grid{ grid-template-columns: 1fr; }
      .checkoutGrid{ grid-template-columns: 1fr; }
      .hero{ padding: 22px 16px; }
      .top{ padding: 12px 12px 10px; }
      .brand img{ width:32px; height:32px; }
    }

    @media (prefers-reduced-motion: reduce){
      #fx{ display:none; }
    }
  </style>
</head>
<body>
  <canvas id="fx"></canvas>
  <div class="noise"></div>

  <div class="wrap">
    <header class="top">
      <div class="topbar">
        <div class="brand" onclick="scrollToTop()" style="cursor:pointer">
          <img src="/logo.png" alt="EasyGoldGlitch logo">
          <div class="t">
            <b>EasyGoldGlitch</b>
            <span>Stop trading. Start printing.</span>
          </div>
        </div>

        <nav class="nav">
          <a class="pill" href="#home">Home</a>
          <a class="pill" href="#glitches">Glitches</a>
          <a class="pill" href="#philosophy">Philosophy</a>
          <a class="pill" href="#terms">Terms</a>
        </nav>

        <div class="actions">
          <button class="iconbtn" id="cartBtn" title="Checkout">
            üõí
            <div class="badge" id="cartCount">0</div>
          </button>
          <button class="iconbtn" id="menuBtn" title="Menu">‚ò∞</button>
        </div>
      </div>
    </header>

    <main id="home">
      <section class="hero">
        <div class="kicker">Crypto-native ¬∑ No sign-up</div>
        <h1>Stop trading.<br/>Start printing.</h1>
        <div class="sub">Pick a glitch. Pay in ETH. Get it delivered.</div>
        <div class="cta">
          <button class="btn primary" onclick="jump('#glitches')">Browse glitches</button>
          <button class="btn" onclick="openCheckout()">Checkout</button>
        </div>
      </section>

      <div class="row">
        <section class="card">
          <h3>Fast picks</h3>
          <div class="muted">Low text. High signal.</div>
          <div class="grid" id="glitchGrid"></div>
        </section>

        <aside class="card">
          <h3>ETH quote</h3>
          <div class="muted" id="ethStatus">Loading‚Ä¶</div>
          <div style="height:10px"></div>
          <div class="muted">
            Pricing uses the <b>7D high</b> (weekly high).<br/>
            This makes ETH totals predictable during spikes.
          </div>
          <div style="height:12px"></div>
          <button class="btn" onclick="refreshEth()">Refresh quote</button>
        </aside>
      </div>

      <section class="card" id="glitches" style="margin-top:14px">
        <h3>Glitches</h3>
        <div class="muted">Tap a card ‚Üí add to cart.</div>
        <div class="grid" id="glitchGrid2" style="margin-top:12px"></div>
      </section>

      <section class="card" id="philosophy" style="margin-top:14px">
        <h3>Philosophy</h3>
        <div class="muted" style="max-width:75ch">
          The creator watched the tape for years and noticed something ugly:
          most flow isn‚Äôt human anymore ‚Äî it‚Äôs automated. Manual traders get hunted by
          latency, liquidity gaps, and execution traps. EasyGoldGlitch exists to ship
          small, controlled systems that don‚Äôt ‚Äúfeel smart‚Äù‚Ä¶ they just execute.
        </div>
      </section>

      <section class="card" id="terms" style="margin-top:14px">
        <h3>Terms</h3>
        <div class="muted" style="max-width:80ch">
          <b>High-risk activity.</b> Trading can result in partial or total loss of capital. Past performance does not guarantee future results.
          This site provides digital software and informational material only ‚Äî not financial advice.
          <br/><br/>
          <b>No refunds.</b> All sales are final due to instant digital delivery.
          <br/><br/>
          <b>Demo licenses:</b> Demo glitches are time-limited to <b>2 months</b> and constrained (single account, minimal risk profile).
          <br/><br/>
          <b>Runtime requirement:</b> Your MT5 terminal and the executable must remain running for proper trade management.
          <br/><br/>
          <b>Delivery:</b> Access is delivered via email after payment verification.
        </div>
      </section>
    </main>

    <!-- Checkout Sheet -->
    <div class="shade" id="shade" onclick="closeSheets()"></div>

    <div class="sheet" id="checkout">
      <div class="hd">
        <div>
          <div style="font-weight:800">Checkout</div>
          <div class="muted" id="checkoutSub">Pay in ETH ¬∑ Paste TxHash</div>
        </div>
        <button class="close" onclick="closeSheets()">‚úï</button>
      </div>
      <div class="bd">
        <div class="checkoutGrid">
          <div>
            <div class="walletBox">
              <img src="/wallet.png" alt="Wallet QR" />
              <div style="min-width:0">
                <div class="muted">Send ETH to:</div>
                <div class="addr" id="walletAddr">Loading address‚Ä¶</div>
                <div style="height:8px"></div>
                <button class="btn" onclick="copyAddr()">Copy address</button>
              </div>
            </div>

            <div style="height:12px"></div>
            <div class="muted">
              Total: <b id="totalUsd">$0</b> ¬∑ <b id="totalEth">‚Äî</b>
              <div class="muted" style="margin-top:6px" id="quoteNote"></div>
            </div>
          </div>

          <div>
            <div class="field">
              <label class="muted">Email (delivery)</label>
              <input id="email" type="email" placeholder="you@domain.com" autocomplete="email" />
            </div>
            <div class="field">
              <label class="muted">TxHash</label>
              <input id="tx" type="text" placeholder="0x‚Ä¶" autocomplete="off" />
            </div>

            <div class="checkrow">
              <input id="agree" type="checkbox" />
              <div>I agree to the Terms & risk disclosure.</div>
            </div>

            <div style="height:12px"></div>
            <button class="btn primary" onclick="verifyStub()">I paid ‚Äî verify</button>
            <div class="muted" style="margin-top:10px">
              (Verification automation comes next. For now, this is UI + quote stability.)
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Menu Sheet -->
    <div class="sheet" id="menu">
      <div class="hd">
        <div>
          <div style="font-weight:800">Menu</div>
          <div class="muted">Fast nav</div>
        </div>
        <button class="close" onclick="closeSheets()">‚úï</button>
      </div>
      <div class="bd">
        <div style="display:flex; gap:10px; flex-wrap:wrap">
          <a class="pill" href="#home" onclick="closeSheets()">Home</a>
          <a class="pill" href="#glitches" onclick="closeSheets()">Glitches</a>
          <a class="pill" href="#philosophy" onclick="closeSheets()">Philosophy</a>
          <a class="pill" href="#terms" onclick="closeSheets()">Terms</a>
          <button class="pill" onclick="openCheckout()">Checkout</button>
        </div>
      </div>
    </div>

    <div class="toast" id="toast"></div>

  </div>

<script>
  // -----------------------------
  // Data model
  // -----------------------------
  const GLITCHES = [
    {
      id: "g1",
      name: "Glitch 1.0 ‚Äî Simple Sample",
      usd: 50,
      tags: ["Demo ¬∑ 2 months", "1 trade at a time", "Low noise"],
      blurb: "A clean, conservative sample. One trade at a time."
    },
    {
      id: "g2",
      name: "Glitch 2.0 ‚Äî Wealth Forge",
      usd: 70,
      tags: ["Demo ¬∑ 2 months", "Slow build", "Stress tested"],
      blurb: "A calmer builder. Focused on consistency."
    },
    {
      id: "g3",
      name: "Glitch Pro ‚Äî F*ck Gold",
      usd: 500,
      tags: ["Pro", "Lifetime", "One-time payment"],
      blurb: "Full power. Built for execution, not opinions."
    },
    {
      id: "g4",
      name: "Little Glitcher",
      usd: 150,
      tags: ["Utility", "Lifetime", "Multi-terminal"],
      blurb: "Runs copy workflows across up to 10 terminals."
    },
  ];

  let cart = new Map(); // id -> qty
  let quote = null;     // { weeklyHighUsd, spotUsd, usdToEthWeeklyHigh, source }

  // -----------------------------
  // UI helpers
  // -----------------------------
  const $ = (id) => document.getElementById(id);

  function money(n){ return `$${Number(n).toFixed(0)}`; }
  function eth(n){
    if (!Number.isFinite(n)) return "‚Äî";
    if (n < 0.001) return `${n.toFixed(6)} ETH`;
    return `${n.toFixed(4)} ETH`;
  }

  function toast(msg){
    const t = $("toast");
    t.textContent = msg;
    t.style.display = "block";
    clearTimeout(toast._k);
    toast._k = setTimeout(()=> t.style.display="none", 2400);
  }

  function vibrate(ms=12){
    try{ if (navigator.vibrate) navigator.vibrate(ms); }catch(e){}
  }

  function jump(hash){
    location.hash = hash;
    document.querySelector(hash)?.scrollIntoView({ behavior:"smooth", block:"start" });
  }
  function scrollToTop(){ window.scrollTo({ top:0, behavior:"smooth" }); }

  function openSheet(id){
    $("shade").style.display = "block";
    $(id).style.display = "block";
    vibrate(10);
  }
  function closeSheets(){
    $("shade").style.display = "none";
    $("checkout").style.display = "none";
    $("menu").style.display = "none";
  }

  function openCheckout(){
    closeSheets();
    recomputeTotals();
    openSheet("checkout");
  }

  // -----------------------------
  // Render
  // -----------------------------
  function renderCards(targetId){
    const root = $(targetId);
    root.innerHTML = "";
    GLITCHES.forEach(g => {
      const div = document.createElement("div");
      div.className = "g";
      div.onclick = () => { addToCart(g.id); };
      div.innerHTML = `
        <div class="topline">
          <b>${g.name}</b>
          <div class="price">${money(g.usd)}</div>
        </div>
        <div class="muted">${g.blurb}</div>
        <div class="tags">${g.tags.map(x=>`<span class="tag">${x}</span>`).join("")}</div>
        <div class="ethline" data-ethline="${g.id}">ETH: ‚Äî</div>
      `;
      root.appendChild(div);
    });
  }

  function addToCart(id){
    cart.set(id, (cart.get(id)||0) + 1);
    $("cartCount").textContent = [...cart.values()].reduce((a,b)=>a+b,0);
    toast("Added to cart");
    vibrate(14);
    recomputeTotals();
  }

  function recomputeTotals(){
    const totalUsd = [...cart.entries()].reduce((sum,[id,qty])=>{
      const g = GLITCHES.find(x=>x.id===id);
      return sum + (g ? g.usd*qty : 0);
    },0);
    $("totalUsd").textContent = money(totalUsd);

    if (quote?.weeklyHighUsd){
      const totalEth = totalUsd / quote.weeklyHighUsd;
      $("totalEth").textContent = eth(totalEth);
      $("quoteNote").textContent = `7D high: $${quote.weeklyHighUsd.toFixed(2)} ¬∑ source: ${quote.source}`;
    } else {
      $("totalEth").textContent = "‚Äî";
      $("quoteNote").textContent = "ETH quote unavailable (retry).";
    }
  }

  function applyEthToCards(){
    const lines = document.querySelectorAll("[data-ethline]");
    lines.forEach(el=>{
      const id = el.getAttribute("data-ethline");
      const g = GLITCHES.find(x=>x.id===id);
      if (!g) return;
      if (quote?.weeklyHighUsd){
        el.textContent = `ETH: ${eth(g.usd / quote.weeklyHighUsd)} (weekly high)`;
      } else {
        el.textContent = `ETH: ‚Äî`;
      }
    });
  }

  // -----------------------------
  // ETH quote fetch (from Pages Function)
  // -----------------------------
  async function refreshEth(){
    $("ethStatus").textContent = "Loading‚Ä¶";
    try{
      const r = await fetch("/api/eth-quote", { cache:"no-store" });
      const j = await r.json();
      if (!j.ok) throw new Error(j.error || "quote failed");
      quote = j;
      localStorage.setItem("egg_quote", JSON.stringify({ t:Date.now(), v:j }));
      $("ethStatus").textContent = `7D high: $${j.weeklyHighUsd.toFixed(2)} ¬∑ spot: $${j.spotUsd.toFixed(2)} ¬∑ ${j.source}`;
      applyEthToCards();
      recomputeTotals();
    }catch(e){
      // fallback from localStorage (last good)
      const raw = localStorage.getItem("egg_quote");
      if (raw){
        try{
          const o = JSON.parse(raw);
          if (Date.now() - o.t < 30*60*1000){
            quote = o.v;
            $("ethStatus").textContent = `Using cached: 7D high $${quote.weeklyHighUsd.toFixed(2)} ¬∑ ${quote.source}`;
            applyEthToCards();
            recomputeTotals();
            return;
          }
        }catch(_){}
      }
      $("ethStatus").textContent = "Quote unavailable. Try again.";
      console.error(e);
    }
  }

  // -----------------------------
  // Wallet address from address.txt
  // -----------------------------
  async function loadAddress(){
    try{
      const r = await fetch("/address.txt", { cache:"no-store" });
      const t = (await r.text()).trim();
      $("walletAddr").textContent = t || "‚Äî";
    }catch(e){
      $("walletAddr").textContent = "‚Äî";
    }
  }
  async function copyAddr(){
    const a = $("walletAddr").textContent.trim();
    if (!a || a==="‚Äî") return toast("No address");
    await navigator.clipboard.writeText(a);
    toast("Address copied");
    vibrate(10);
  }

  function verifyStub(){
    if (![...cart.keys()].length) return toast("Cart is empty");
    if (!$("agree").checked) return toast("Accept Terms first");
    if (!$("email").value.trim()) return toast("Email required");
    if (!$("tx").value.trim().startsWith("0x")) return toast("TxHash required");
    toast("UI ready ‚Äî verification backend is next");
    vibrate(16);
  }

  // -----------------------------
  // Dopamine popups (light)
  // -----------------------------
  const POPS = [
    "Someone just grabbed Simple Sample.",
    "Wealth Forge is trending.",
    "A Pro license was minted.",
    "Little Glitcher added to cart."
  ];
  function startPops(){
    setInterval(()=>{
      if (Math.random() < 0.55){
        toast(POPS[Math.floor(Math.random()*POPS.length)]);
      }
    }, 9000);
  }

  // -----------------------------
  // Particle engine: clustered random + tap bursts
  // -----------------------------
  function startFX(){
    const canvas = document.getElementById("fx");
    const ctx = canvas.getContext("2d", { alpha:true });
    let w=0,h=0,dpr=1;

    const reduce = matchMedia("(prefers-reduced-motion: reduce)").matches;
    if (reduce) return;

    const isMobile = matchMedia("(max-width: 860px)").matches;
    const BASE = isMobile ? 80 : 140;

    const clusters = [];
    const particles = [];
    const gridSize = 90;
    let pointer = { x: -9999, y: -9999, down:false };

    function resize(){
      dpr = Math.min(2, window.devicePixelRatio || 1);
      w = canvas.width = Math.floor(innerWidth * dpr);
      h = canvas.height = Math.floor(innerHeight * dpr);
      canvas.style.width = innerWidth + "px";
      canvas.style.height = innerHeight + "px";
      ctx.setTransform(1,0,0,1,0,0);
    }

    function rand(a,b){ return a + Math.random()*(b-a); }

    function addCluster(x,y, n=18){
      const c = {
        x: x, y: y,
        vx: rand(-.10,.10)*dpr, vy: rand(-.10,.10)*dpr,
        pull: rand(.002,.006)*dpr
      };
      clusters.push(c);
      for (let i=0;i<n;i++){
        particles.push({
          x: x + rand(-120,120)*dpr,
          y: y + rand(-120,120)*dpr,
          vx: rand(-.55,.55)*dpr,
          vy: rand(-.55,.55)*dpr,
          r: rand(1.0, 2.2)*dpr,
          a: rand(.35,.95),
          c: c
        });
      }
      // keep counts bounded
      while (particles.length > BASE) particles.shift();
      while (clusters.length > Math.max(6, Math.floor(BASE/18))) clusters.shift();
    }

    function seed(){
      clusters.length = 0;
      particles.length = 0;
      const k = isMobile ? 5 : 7;
      for (let i=0;i<k;i++){
        addCluster(rand(0,w), rand(0,h), isMobile ? 14 : 18);
      }
    }

    function burst(x,y){
      addCluster(x,y, isMobile ? 12 : 18);
      // ripple
      ripples.push({ x,y, t:0 });
      vibrate(10);
    }

    // ripples
    const ripples = [];

    function spatialKey(x,y){
      return ((x/gridSize)|0) + "," + ((y/gridSize)|0);
    }

    function step(){
      ctx.clearRect(0,0,w,h);

      // soft vignette
      const g = ctx.createRadialGradient(w*.5,h*.45, 0, w*.5,h*.45, Math.max(w,h)*.65);
      g.addColorStop(0, "rgba(255,255,255,0.02)");
      g.addColorStop(1, "rgba(0,0,0,0.0)");
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);

      // update clusters (slow drift)
      for (const c of clusters){
        c.vx += rand(-.002,.002)*dpr;
        c.vy += rand(-.002,.002)*dpr;
        c.vx *= .995; c.vy *= .995;
        c.x += c.vx; c.y += c.vy;
        if (c.x < 0 || c.x > w) c.vx *= -1;
        if (c.y < 0 || c.y > h) c.vy *= -1;
      }

      // spatial hash
      const grid = new Map();
      for (const p of particles){
        const k = spatialKey(p.x,p.y);
        if (!grid.has(k)) grid.set(k, []);
        grid.get(k).push(p);
      }

      // draw links + update particles
      for (const p of particles){
        // pull toward cluster center (regroup)
        const dx = (p.c.x - p.x);
        const dy = (p.c.y - p.y);
        p.vx += dx * p.c.pull;
        p.vy += dy * p.c.pull;

        // pointer gravity + swirl
        const px = pointer.x - p.x;
        const py = pointer.y - p.y;
        const pd2 = px*px + py*py;
        if (pd2 < (220*220)*dpr*dpr){
          const inv = 1 / Math.max(1200, pd2);
          const s = pointer.down ? 520 : 260;
          // attract
          p.vx += px * inv * s * dpr;
          p.vy += py * inv * s * dpr;
          // swirl
          p.vx += -py * inv * (pointer.down ? 320 : 160) * dpr;
          p.vy +=  px * inv * (pointer.down ? 320 : 160) * dpr;
        }

        // separation (avoid over-clumping)
        const gx = (p.x/gridSize)|0, gy = (p.y/gridSize)|0;
        for (let ox=-1; ox<=1; ox++){
          for (let oy=-1; oy<=1; oy++){
            const kk = (gx+ox)+","+(gy+oy);
            const bucket = grid.get(kk);
            if (!bucket) continue;
            for (const q of bucket){
              if (q === p) continue;
              const ax = p.x - q.x;
              const ay = p.y - q.y;
              const d2 = ax*ax + ay*ay;
              if (d2 > 0 && d2 < (38*38)*dpr*dpr){
                const f = 0.9 / d2;
                p.vx += ax * f;
                p.vy += ay * f;
              }
            }
          }
        }

        // integrate
        p.vx *= .985; p.vy *= .985;
        p.x += p.vx; p.y += p.vy;

        // wrap edges
        if (p.x < -40*dpr) p.x = w + 40*dpr;
        if (p.x > w + 40*dpr) p.x = -40*dpr;
        if (p.y < -40*dpr) p.y = h + 40*dpr;
        if (p.y > h + 40*dpr) p.y = -40*dpr;

        // links (local)
        const kk = spatialKey(p.x,p.y);
        const bucket = grid.get(kk) || [];
        for (const q of bucket){
          if (q === p) continue;
          const ax = p.x - q.x;
          const ay = p.y - q.y;
          const d = Math.hypot(ax,ay);
          if (d < 120*dpr){
            const alpha = (1 - d/(120*dpr)) * 0.18 * (p.a + q.a) * 0.5;
            ctx.strokeStyle = `rgba(215,181,106,${alpha})`;
            ctx.lineWidth = 1*dpr;
            ctx.beginPath();
            ctx.moveTo(p.x,p.y);
            ctx.lineTo(q.x,q.y);
            ctx.stroke();
          }
        }

        // particle dot
        ctx.fillStyle = `rgba(255,255,255,${0.10 * p.a})`;
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
        ctx.fill();

        // gold glow occasionally
        if (Math.random() < 0.015){
          ctx.fillStyle = `rgba(215,181,106,${0.08 * p.a})`;
          ctx.beginPath();
          ctx.arc(p.x,p.y,p.r*3.2,0,Math.PI*2);
          ctx.fill();
        }
      }

      // ripples
      for (let i=ripples.length-1;i>=0;i--){
        const r = ripples[i];
        r.t += 1;
        const radius = r.t * 9 * dpr;
        const a = Math.max(0, 0.22 - r.t*0.004);
        ctx.strokeStyle = `rgba(215,181,106,${a})`;
        ctx.lineWidth = 2*dpr;
        ctx.beginPath();
        ctx.arc(r.x,r.y,radius,0,Math.PI*2);
        ctx.stroke();
        if (a <= 0) ripples.splice(i,1);
      }

      requestAnimationFrame(step);
    }

    resize();
    seed();
    step();

    window.addEventListener("resize", ()=>{ resize(); seed(); }, { passive:true });

    // interactive taps / clicks
    window.addEventListener("pointermove", (e)=>{
      pointer.x = e.clientX * dpr;
      pointer.y = e.clientY * dpr;
    }, { passive:true });

    window.addEventListener("pointerdown", (e)=>{
      pointer.down = true;
      burst(e.clientX*dpr, e.clientY*dpr);
    }, { passive:true });

    window.addEventListener("pointerup", ()=>{ pointer.down = false; }, { passive:true });
  }

  // -----------------------------
  // Init
  // -----------------------------
  $("cartBtn").addEventListener("click", openCheckout);
  $("menuBtn").addEventListener("click", ()=> openSheet("menu"));

  renderCards("glitchGrid");
  renderCards("glitchGrid2");

  loadAddress();
  refreshEth();
  startFX();
  startPops();

  function refreshEth(){ return window.refreshEth(); }
  window.refreshEth = refreshEth;
</script>
</body>
</html>
